{{ define "content" }}
<div x-data="viewData({
    id: '{{ .Id }}'
})">
    <div class="flex mb-3">
        <div class="flex-grow font-bold self-center py-2">
            <h4 class="text-lg" x-text="about.name">repository-name</h4>
        </div>
        <div class="flex-none">
            <a 
                x-bind:href="about.link"
                target="_blank"
                class="flex items-center bg-[#FF5800] hover:bg-[#FF4300] text-white py-2 px-4 rounded">
                <span>
                    Open in GitHub
                </span>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="flex-shrink-0 w-5 h-5 ml-2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25" />
                </svg>
            </a>
        </div>
    </div>
    <div class="flex flex-wrap">
        <div class="border rounded-xl p-5 w-full order-last lg:order-first lg:w-2/3">
            <nav class="flex space-x-4" aria-label="Tabs">
                <div class="px-3 py-2 font-medium text-sm rounded-md cursor-pointer bg-[#fff2eb] text-[#FF5800]">
                    Read Me
                </div>
                <div class="px-3 py-2 font-medium text-sm rounded-md cursor-pointer text-gray-500 hover:text-gray-700">
                    Collaborators 
                </div>
                <div class="px-3 py-2 font-medium text-sm rounded-md cursor-pointer text-gray-500 hover:text-gray-700">
                    Approval Requests 
                </div>
            </nav>
            <div x-data="markdownEditor({
                disabledTab: true,
                defaultTab: 'preview',
                overflowPreview: 'auto'
            })" x-modelable="body" x-model="readme">
                <div x-html="template"></div>
            </div>
        </div>
        <div class="p-5 w-full lg:w-1/3">
            <article class="text-wrap mb-3">
                <h3 class="text-gray-600 font-medium mb-2">About</h3>
                <p class="text-gray-500" x-text="about.description">
                    Lorem ipsum is placeholder text commonly used in the graphic, print, and publishing industries for previewing layouts and visual mockups.
                </p>
            </article>
            <div class="flex items-center text-sm text-gray-500 mb-2" title="Repository Source">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                  stroke="#9CA3AF" class="flex-shrink-0 mr-1.5 h-5 w-5 text-gray-400">
                  <path stroke-linecap="round" stroke-linejoin="round"
                    d="M17.25 6.75L22.5 12l-5.25 5.25m-10.5 0L1.5 12l5.25-5.25m7.5-3l-4.5 16.5" />
                </svg>
                <span x-text="about.repositorySource">GitHub</span>
            </div>
            <div class="flex items-center text-sm text-gray-500 mb-2" title="Visibility">
                <svg xmlns="http://www.w3.org/2000/svg" class="flex-shrink-0 mr-1.5 h-5 w-5 text-gray-400"
                    fill="none" viewBox="0 0 20 20" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round"
                    d="M14 10l-2 1m0 0l-2-1m2 1v2.5M20 7l-2 1m2-1l-2-1m2 1v2.5M14 4l-2-1-2 1M4 7l2-1M4 7l2 1M4 7v2.5M12 21l-2-1m2 1l2-1m-2 1v-2.5M6 18l-2-1v-2.5M18 18l2-1v-2.5" />
                </svg>
                <span x-text="about.visibility">Private</span>
            </div>
            <div class="flex items-center text-sm text-gray-500 mb-5">
                <svg class="flex-shrink-0 mr-1.5 h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                    <path fill-rule="evenodd"
                    d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z"
                    clip-rule="evenodd" />
                </svg>
                <span>
                    Created on <time x-text="about.created">Feb 23, 2024, 7:28 PM</time>
                </span>
            </div>
            <div class="flex flex-wrap mt-2">
                <template x-if="about.topics" >
                    <template x-for="(topic) in about.topics" >
                      <a x-bind:href="'/search?search=' + topic">
                        <div class="text-xs px-2 py-1 mr-2 mb-1 bg-sky-100 rounded-lg text-sky-800 items-center flex whitespace-nowrap" x-text="topic">
                        </div>
                      </a>
                    </template>
                  </template>
            </div>
        </div>
    </div>
</div>

<script src="/public/components/markdownEditor.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked@2.1.3/marked.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/emojione@3.1.2/lib/js/emojione.min.js"></script>
<script type="text/javascript">
    const viewData = ({
        id = undefined
    }) => {
        return {
            id: 0,
            readme: "",
            about: {
                name: "",
                repoId: 0,
                description: "",
                repositorySource: "",
                visibility: "",
                created: "",
                topics: []
            },
            async init(){
                this.id = id;

                const repoDetails = await getRepositoryById(this.id)

                const readme = await getRepositoryReadme(repoDetails.Visibility, repoDetails.Name)
                
                const created = new Date(repoDetails.Created)
                
                this.readme = readme;
                this.about = {
                    name: repoDetails.Name,
                    repoId: repoDetails.Id,
                    description: repoDetails.Description,
                    repositorySource: repoDetails.RepositorySource,
                    visibility: repoDetails.Visibility,
                    created: created.toDateString(),
                    link: repoDetails.TFSProjectReference,
                    topics: repoDetails.RepoTopics
                };
            }
        }
    }

    async function getRepositoryById(id) {
        const res = await fetch(
            `/api/repositories/${id}`
        )

        const data = await res.json()
        return data
    }

    async function getRepositoryReadme(visibility, repoName) {
        const res = await fetch(
            `/api/repositories/${visibility}/${repoName}/readme`
        )

        const data = await res.json()
        return data
    }
</script>
{{ end }}